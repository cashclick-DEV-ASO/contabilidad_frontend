var p=Object.defineProperty;var j=(e,s,t)=>s in e?p(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var n=(e,s,t)=>(j(e,typeof s!="symbol"?s+"":s,t),t),a=(e,s,t)=>{if(!s.has(e))throw TypeError("Cannot "+t)};var h=(e,s,t)=>(a(e,s,"read from private field"),t?t.call(e):s.get(e)),c=(e,s,t)=>{if(s.has(e))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(e):s.set(e,t)},l=(e,s,t,o)=>(a(e,s,"write to private field"),o?o.call(e,t):s.set(e,t),t);import{g as f,l as g,m as u,e as m,C as i,M as C}from"./componente-60a89e82.js";class w{constructor(s){this.api=s,this.resultado=null,this.error=null}async post(s,t){try{const o=await this.postSync(s,t);await this.procesaResultado(o)}catch(o){this.error=o,this.resultado=null}}postSync(s,t){return fetch(`${this.api}/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async get(s){try{const t=await this.getSync(s);await this.procesaResultado(t)}catch(t){this.error=t,this.resultado=null}}getSync(s){return fetch(`${this.api}/${s}`)}async procesaResultado(s){try{const t=await this.procesaResultadoSync(s);this.success=t.success,this.informacion=t.informacion,this.error=null}catch(t){this.error=t,this.success=!1,this.informacion=null}}procesaResultadoSync(s){return s.json()}}class T extends w{constructor(){super(f()),this.user="",this.pass="",this.mensaje="No se han proporcionado credenciales de acceso.",g()}setUsuario(s){this.user=s}setPassword(s){this.pass=s}async login(){return this.valida()!=!0?!1:(await this.post("login",{user:this.user,pass:this.pass}),this.informacion?(this.success?(m("TOKEN",this.informacion.token,{"max-age":30*60*1e3,secure:!0}),m("NOMBRE",this.informacion.nombre)):(this.mensaje="Credenciales incorrectas.",u(this.informacion)),this.success):(this.mensaje=`Ocurrió un problema al validar la información.
Intente nuevamente o contacte al administrador.`,u(this.error),!1))}valida(){return this.user===""&&this.pass===""?this.mensaje="No se han proporcionado credenciales de acceso.":this.user===""?this.mensaje="No se ha proporcionado el nombre de usuario.":this.pass===""?this.mensaje="No se ha proporcionado la contraseña.":!0}}class d extends i{constructor(s=null){return super("div",{clase:C}),this.txtTitulo="Mensaje de sistema",this.txtMensaje="",this.tipo={ERROR:"msjError",EXITO:"msjExito",ADVERTENCIA:"msjAdvertencia",INFORMACION:"msjInformacion"},this.titulosDefault={msjError:"Error",msjExito:"Éxito",msjAdvertencia:"Advertencia",msjInformacion:"Información"},this.tipo=s??this.tipo.INFORMACION,this.listo=!1,this.botones=[],this.inicia(),this}setMensaje(s){return this.txtMensaje=s,this}setTipo(s){return this.tipo=s,this.txtTitulo=this.titulosDefault[s],this}setTitulo(s){return this.txtTitulo=s,this}setBotones(s){return this.botones=s,this}inicia(){return this.marco=new i("div",{clase:"msjMarco"}),this.titulo=new i("span",{clase:"msjTitulo"}),this.cerrar=new i("span",{clase:"msjCerrar"}),this.mensaje=new i("span",{clase:"msjTexto"}),this}configura(){return this.marco.setClase(this.tipo),this.titulo.setTexto(this.txtTitulo),this.cerrar.setTexto("X"),this.cerrar.setListener("click",this.ocultar.bind(this)),this.mensaje.setTexto(this.txtMensaje),this}crea(){return this.marco.addHijos([this.titulo.getComponente(),this.cerrar.getComponente(),this.mensaje.getComponente()]),this.addHijo(this.marco.getComponente()),this}mostrar(){const s=this.configura().crea();document.querySelector("body").appendChild(s.getComponente())}ocultar(){this.removeComponente()}}class x{constructor(){this.elementos=[],this.listo=!1,this.mensaje=new d}msjError(s){this.msj(s,this.mensaje.tipo.ERROR)}msjExito(s){this.msj(s,this.mensaje.tipo.EXITO)}msjAdvertencia(s){this.msj(s,this.mensaje.tipo.ADVERTENCIA)}msjInformacion(s){this.msj(s,this.mensaje.tipo.INFORMACION)}msj(s,t=this.mensaje.tipo.INFORMACION){new d().setTipo(t).setMensaje(s).mostrar()}}class y extends x{constructor(t){super();n(this,"login",async t=>{t.preventDefault(),this.modelo.setUsuario(this.formulario.usuario.getValor()),this.modelo.setPassword(this.formulario.password.getValor()),await this.modelo.login()?window.location.href="/":this.msjError(this.modelo.mensaje)});this.formulario=t,this.modelo=new T}}var r;class E extends i{constructor(){super("form",{clase:"formulario"});c(this,r,void 0);return l(this,r,new y(this)),this.inicia()}inicia(){return this.titulo=new i("label",{clase:"lblTitulo"}),this.usuario=new i("input",{clase:"inputLogin"}),this.password=new i("input",{clase:"inputLogin"}),this.btnLogin=new i("button",{clase:"btnLogin"}),this}configura(){return this.titulo.setTexto("Inicio de sesión"),this.usuario.setPropiedad("placeholder","Usuario"),this.password.setPropiedad("type","password"),this.password.setPropiedad("placeholder","Contraseña"),this.btnLogin.setTexto("Iniciar sesión"),this.setListener("submit",h(this,r).login),this}crea(){return this.addHijos([this.titulo.getComponente(),this.usuario.getComponente(),this.password.getComponente(),this.btnLogin.getComponente()]),this}mostrar(){return this.configura().crea().getComponente()}}r=new WeakMap;const R=()=>{document.querySelector(".login").appendChild(new E().mostrar())};R();
